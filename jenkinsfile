node {
    def app
    stage('Clone') {
        checkout scm
    }
    stage('Build') {
        app = docker.build("usero56tl/tomcat:1.0")
    }
    stage('Test image') {
        withDockerContainer("usero56tl/tomcat:1.0"){ sh "echo 'hello world'" }
    }
    stage('Pushing to Docker hub') {
        sh 'echo $dockerhub_PWD | docker login -u $dockerhub_USR --password-stdin'
        
        sh 'docker push usero56tl/tomcat:1.0'
    }
}